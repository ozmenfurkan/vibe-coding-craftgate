---
description: "Postman collection management and scenario-based API testing standards."
globs: "*"
alwaysApply: true
---

# Postman Collection Management

You must ALWAYS maintain Postman collections synchronized with the API implementation. Every API change requires corresponding Postman updates.

## ğŸ¯ CRITICAL RULES (MUST)

### 1. Scenario-Based Collections (MANDATORY)

**Every Postman collection MUST be organized by business scenarios, NOT by endpoints.**

âŒ **WRONG Structure:**
```
Payment API/
â”œâ”€â”€ GET /api/payments
â”œâ”€â”€ POST /api/payments
â”œâ”€â”€ DELETE /api/payments
â””â”€â”€ ...
```

âœ… **CORRECT Structure:**
```
Payment API/
â”œâ”€â”€ ğŸ“ Scenario 1: Successful Payment Flow
â”‚   â”œâ”€â”€ 1.1 - Create New Payment
â”‚   â”œâ”€â”€ 1.2 - Verify Payment Status
â”‚   â””â”€â”€ 1.3 - Get Payment Receipt
â”‚
â”œâ”€â”€ ğŸ“ Scenario 2: Payment Failure - Insufficient Funds
â”‚   â”œâ”€â”€ 2.1 - Create Payment (Amount > Balance)
â”‚   â””â”€â”€ 2.2 - Verify Failure Response
â”‚
â”œâ”€â”€ ğŸ“ Scenario 3: Payment Cancellation
â”‚   â”œâ”€â”€ 3.1 - Create Payment
â”‚   â”œâ”€â”€ 3.2 - Cancel Payment
â”‚   â””â”€â”€ 3.3 - Verify Cancellation Status
â”‚
â””â”€â”€ ğŸ“ Setup & Teardown
    â”œâ”€â”€ 0.1 - Get Auth Token
    â””â”€â”€ 0.9 - Cleanup Test Data
```

### 2. Scenario Update Synchronization (MANDATORY)

**When ANY business scenario changes in code:**
1. âœ… Update the corresponding Postman scenario immediately
2. âœ… Add/remove requests to match the new flow
3. âœ… Update test assertions
4. âœ… Update documentation
5. âœ… Verify the scenario still works end-to-end

**Example:**
```
Code Change: Added email notification step to payment flow
â†“
Postman Update Required:
- Add new request: "1.4 - Verify Email Notification Sent"
- Update scenario description
- Add assertion for email delivery
```

### 3. Code Analysis for Postman Updates

**Before implementing ANY code change, analyze:**

#### When Postman Updates ARE Required:
- âœ… New API endpoint added â†’ Create new scenario
- âœ… Request/response format changed â†’ Update request body & tests
- âœ… New validation rule added â†’ Add negative test scenario
- âœ… Business flow changed â†’ Reorganize scenario steps
- âœ… New error code introduced â†’ Add failure scenario
- âœ… Authentication method changed â†’ Update all requests
- âœ… New query parameter added â†’ Update relevant requests

#### When Postman Updates are NOT Required:
- âŒ Internal refactoring (no API contract change)
- âŒ Code formatting changes
- âŒ Comment updates
- âŒ Performance optimization (same behavior)

### 4. Collection Organization Standards

**Naming Convention:**
```
{Scenario Number} - {Scenario Name}/
  {Step Number}.{SubStep} - {Action Description}
```

**Example:**
```
1 - Happy Path: User Registration/
  1.1 - Register New User
  1.2 - Verify Email
  1.3 - Login with New Credentials
  1.4 - Get User Profile
```

**Numbering Rules:**
- `0.x` - Setup/Authentication
- `1.x-9.x` - Main scenarios (ordered by importance)
- `10.x+` - Edge cases & error scenarios
- `99.x` - Teardown/Cleanup

## ğŸ“‹ Request Standards

### Request Naming
```
{Step} - {HTTP Method} {Action} [{Expected Result}]

Examples:
âœ… "1.1 - POST Create Payment [Success]"
âœ… "2.1 - POST Create Payment [Fail: Insufficient Funds]"
âœ… "3.2 - GET Verify Payment Status [Pending]"
```

### Request Description (MUST Include)
```markdown
## Purpose
Brief description of what this request does in the scenario.

## Expected Behavior
- Status Code: 200
- Response Time: < 500ms
- Business Rule: Payment status should be "PENDING"

## Test Data
- Card Number: {{test_card_success}}
- Amount: {{test_amount_valid}}

## Dependencies
- Requires: 1.1 - POST Create Payment
- Sets Variables: {{payment_id}}
```

## âœ… Test Scripts (MANDATORY)

**Every request MUST have test scripts:**

### Basic Tests (Minimum Required)
```javascript
// Status code validation
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

// Response time validation
pm.test("Response time is less than 500ms", function () {
    pm.expect(pm.response.responseTime).to.be.below(500);
});

// Response structure validation
pm.test("Response has required fields", function () {
    var jsonData = pm.response.json();
    pm.expect(jsonData).to.have.property('success');
    pm.expect(jsonData).to.have.property('data');
});
```

### Business Logic Tests (Scenario-Specific)
```javascript
// Validate business rules
pm.test("Payment amount matches request", function () {
    var jsonData = pm.response.json();
    var requestData = JSON.parse(pm.request.body.raw);
    pm.expect(jsonData.data.amount).to.eql(requestData.amount);
});

// Set variables for next requests
pm.test("Save payment ID for next step", function () {
    var jsonData = pm.response.json();
    pm.collectionVariables.set("payment_id", jsonData.data.id);
});
```

### Security Tests (FinTech MUST)
```javascript
// Ensure no sensitive data in logs
pm.test("Response does not contain PAN", function () {
    var responseText = pm.response.text();
    // PAN pattern check (should be masked)
    pm.expect(responseText).to.not.match(/\d{16}/);
});

// Validate response headers
pm.test("Security headers present", function () {
    pm.response.to.have.header("X-Content-Type-Options");
    pm.response.to.have.header("X-Frame-Options");
});
```

## ğŸ” Environment Variables

**Structure:**
```
{{base_url}}          - API base URL
{{api_version}}       - /v1, /v2, etc.
{{auth_token}}        - JWT token (auto-refreshed)

# Test Data
{{test_card_success}}    - Valid test card
{{test_card_decline}}    - Declining test card
{{test_amount_valid}}    - Valid amount (e.g., 10.00)
{{test_amount_invalid}}  - Invalid amount (e.g., 0.01)

# Dynamic Variables (set by tests)
{{payment_id}}           - Current payment ID
{{transaction_id}}       - Current transaction ID
{{user_id}}             - Current user ID
```

**NEVER hardcode:**
- âŒ URLs (use `{{base_url}}`)
- âŒ Credentials (use environment variables)
- âŒ Test card numbers (use `{{test_card_*}}`)
- âŒ Merchant IDs (use `{{merchant_id}}`)

## ğŸ“ Collection Structure Template

```
{Project Name} API/
â”‚
â”œâ”€â”€ ğŸ“ 0 - Setup & Authentication
â”‚   â”œâ”€â”€ 0.1 - Health Check
â”‚   â”œâ”€â”€ 0.2 - Get Auth Token
â”‚   â””â”€â”€ 0.3 - Verify Token
â”‚
â”œâ”€â”€ ğŸ“ 1 - Happy Path: {Main Scenario}
â”‚   â”œâ”€â”€ 1.1 - {First Step}
â”‚   â”œâ”€â”€ 1.2 - {Second Step}
â”‚   â””â”€â”€ 1.x - {Final Step}
â”‚
â”œâ”€â”€ ğŸ“ 2 - Alternative Flow: {Variant Scenario}
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ 10 - Error Scenarios
â”‚   â”œâ”€â”€ 10.1 - Invalid Input
â”‚   â”œâ”€â”€ 10.2 - Unauthorized Access
â”‚   â””â”€â”€ 10.x - ...
â”‚
â””â”€â”€ ğŸ“ 99 - Cleanup
    â””â”€â”€ 99.1 - Delete Test Data
```

## ğŸ”„ Synchronization Workflow

### When Adding New Endpoint:
```
1. âœ… Implement endpoint in backend
2. âœ… Identify which scenario(s) it belongs to
3. âœ… Add request to appropriate scenario folder
4. âœ… Write comprehensive tests
5. âœ… Update collection documentation
6. âœ… Test the entire scenario end-to-end
```

### When Modifying Endpoint:
```
1. âœ… Update request body/headers
2. âœ… Update response validation tests
3. âœ… Check if scenario flow changed
4. âœ… Update documentation
5. âœ… Re-run scenario to verify
```

### When Removing Endpoint:
```
1. âœ… Remove from Postman collection
2. âœ… Check if scenario is still complete
3. âœ… Update scenario documentation
4. âœ… Archive old version (for reference)
```

## ğŸ“ Documentation Standards

**Collection Description (MUST):**
```markdown
# {Project Name} API Collection

## Purpose
Brief description of what this API does.

## Base URL
- Production: https://api.production.com
- Staging: https://api.staging.com
- Local: http://localhost:8080

## Authentication
- Type: Bearer Token / API Key
- How to obtain: Run "0.2 - Get Auth Token"

## Test Data
List of available test cards, users, etc.

## Scenarios Overview
1. Happy Path: Main user journey
2. Error Cases: Common failure scenarios
...

## Version
- API Version: v1.0.0
- Collection Version: 1.0.0
- Last Updated: 2024-01-15
```

## ğŸ¯ Quality Checklist

Before considering Postman collection complete:

- [ ] All scenarios are organized by business flow (NOT by endpoint)
- [ ] Every request has a clear purpose in its scenario
- [ ] All requests have test scripts
- [ ] All sensitive data uses environment variables
- [ ] Response validation checks business rules
- [ ] Error scenarios are covered
- [ ] Collection documentation is up-to-date
- [ ] Scenarios can run independently
- [ ] No hardcoded values (URLs, credentials, test data)
- [ ] Security tests verify no PII in responses

## ğŸš¨ Common Mistakes to Avoid

### âŒ Endpoint-Based Organization
```
# WRONG - Organized by HTTP methods
GET Requests/
  Get Payment
  Get Transaction
POST Requests/
  Create Payment
  Create Transaction
```

### âœ… Scenario-Based Organization
```
# CORRECT - Organized by business scenarios
Complete Payment Flow/
  1.1 - Create Payment
  1.2 - Process Transaction
  1.3 - Get Receipt
```

### âŒ Missing Context
```
# WRONG - No context
Request Name: "Create Payment"
```

### âœ… Clear Context
```
# CORRECT - Clear scenario context
Request Name: "1.1 - Create Payment [Success - Happy Path]"
Description: "First step in successful payment scenario..."
```

## ğŸ”— Integration with Development

**When reviewing code changes, ALWAYS check:**
1. Does this change affect API contract? â†’ Update Postman
2. Is there a new business scenario? â†’ Create new folder
3. Are there new validation rules? â†’ Add test scenarios
4. Did error handling change? â†’ Update error scenarios

**Postman collection is NOT optional documentation.**
**It is a LIVING, EXECUTABLE specification of your API.**

---

**Scenario-based testing ensures business flows work, not just individual endpoints.** ğŸ¯
